var Graph=function(t,i){this.canvas=t,this.dataset=i,this.points=[],this.position={x:0,y:0},this.min=0,this.max=0,this.highlight="",this.point={},this.ratio=1,this.realWidth,this.tooltip={x:0,y:0},this.init(),this.convert(),this.listen();var o=this;setInterval(function(){o.draw()},20)};Graph.prototype.init=function(){this.canvas.getContext("2d");this.makeHighRes()},Graph.prototype.listen=function(){var t=this;this.canvas.addEventListener("mousemove",function(i){t.position=t.getMousePos(i)},!1),this.canvas.addEventListener("touchmove",function(i){t.position=t.getMousePos(i)},!1),this.canvas.addEventListener("touchstart",function(i){t.position=t.getMousePos(i)},!1)},Graph.prototype.convert=function(){var t=0,i=0;this.dataset.forEach(function(o){o.x>t&&(t=o.x),o.y>i&&(i=o.y)});var o=t,s=i;this.dataset.forEach(function(t){t.x<o&&(o=t.x),t.y<s&&(s=t.y)});var a=Math.abs(t-o),e=Math.abs(i-s),h=this.canvas.width-20,n=20;if(this.min=n,this.max=h,a>e)var r=t,l=o;else var r=i,l=s;console.log(h+" "+n);var c=r-l,p=h-n,v=this;this.dataset.forEach(function(t){var i={x:(t.x-l)*p/c+n,y:v.canvas.width-20-((t.y-l)*p/c+n)};v.points.push(i)}),console.log(this.points)},Graph.prototype.draw=function(t){function i(t,i){for(var o=i[0],s=Math.abs(t-o.x),a=0;a<i.length;a++){var e=Math.abs(t-i[a].x);e<s&&(s=e,o=i[a])}return o}var o=this.canvas,s=o.getContext("2d"),a=0;this.realWidth/this.points.length;s.clearRect(0,0,o.width,o.height),s.fillStyle="#FFF",s.fillRect(0,0,o.width,o.height),s.fillStyle="#FFF",s.beginPath(),s.save();s.moveTo(this.points[0].x,this.points[0].y);for(var a=0;a<this.points.length;a++)s.lineTo(this.points[a].x,this.points[a].y);if(s.strokeStyle="#00C853",s.lineWidth=2*this.ratio,s.shadowColor="#999",s.shadowBlur=1,s.shadowOffsetX=2,s.shadowOffsetY=2,s.stroke(),s.restore(),this.position.x){var i=i(this.position.x,this.points);s.save(),s.beginPath(),s.moveTo(i.x,0),s.lineTo(i.x,o.height),s.strokeStyle="#777777",s.stroke(),s.restore(),s.save(),s.beginPath(),s.arc(i.x,i.y,5*this.ratio,0,2*Math.PI,!1),s.fillStyle="#00C853",s.shadowColor="#999",s.shadowBlur=10,s.shadowOffsetX=2,s.shadowOffsetY=2,s.fill(),s.restore(),this.drawTooltip(i)}},Graph.prototype.drawTooltip=function(t){var i=this.canvas.getContext("2d"),o=20*this.ratio;this.position.x>t.x&&(o=-70*this.ratio);var s={x:t.x+o,y:t.y-10},a={x:Math.abs(this.tooltip.x-s.x)/15,y:Math.abs(this.tooltip.y-s.y)/15};this.tooltip.x!=s.x&&(s.x>this.tooltip.x?this.tooltip.x+=a.x:this.tooltip.x-=a.x),this.tooltip.y!=s.y&&(s.y>this.tooltip.y?this.tooltip.y+=a.y:this.tooltip.y-=a.y),i.save(),i.beginPath(),i.rect(this.tooltip.x,this.tooltip.y,50*this.ratio,20*this.ratio),i.fillStyle="#cccccc",i.shadowColor="#999",i.shadowBlur=10,i.shadowOffsetX=10,i.shadowOffsetY=10,i.fill(),i.restore()},Graph.prototype.getMousePos=function(t){t.preventDefault();var i=this.canvas.getBoundingClientRect();return window.event.touches?{x:(window.event.touches[0].pageX-i.left)*this.ratio,y:(window.event.touches[0].pageY-i.top)*this.ratio}:{x:(t.clientX-i.left)*this.ratio,y:(t.clientY-i.top)*this.ratio}},Graph.prototype.makeHighRes=function(){var t=this.canvas.getContext("2d"),i=window.devicePixelRatio||1,o=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,s=i/o;if(i!==o){var a=this.canvas.width,e=this.canvas.height;this.canvas.width=Math.round(a*s),this.canvas.height=Math.round(e*s),this.canvas.style.width=a+"px",this.canvas.style.height=e+"px",t.save(),t.scale(s,s),this.ratio=s,t.restore()}};