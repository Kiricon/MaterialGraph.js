var Graph=function(t,i){this.canvas=t,this.dataset=i,this.points=[],this.position={x:0,y:0},this.min=0,this.max=0,this.highlight="",this.point={},this.ratio=1,this.realWidth,this.tooltip={x:0,y:0,radius:0,oldx:0},this.init(),this.convert(),this.listen();var o=this;setInterval(function(){o.draw()},20)};Graph.prototype.init=function(){this.canvas.getContext("2d");this.makeHighRes()},Graph.prototype.listen=function(){var t=this;this.canvas.addEventListener("mousemove",function(i){t.position=t.getMousePos(i)},!1),this.canvas.addEventListener("touchmove",function(i){t.position=t.getMousePos(i)},!1),this.canvas.addEventListener("touchstart",function(i){t.position=t.getMousePos(i)},!1)},Graph.prototype.convert=function(){var t=this.canvas.width/10,i=0,o=0;this.dataset.forEach(function(t){t.x>i&&(i=t.x),t.y>o&&(o=t.y)});var s=i,a=o;this.dataset.forEach(function(t){t.x<s&&(s=t.x),t.y<a&&(a=t.y)});var e=Math.abs(i-s),h=Math.abs(o-a),n=this.canvas.width-t,r=t;if(this.min=r,this.max=n,e>h)var l=i,c=s;else var l=o,c=a;console.log(n+" "+r);var x=l-c,p=n-r,v=this;this.dataset.forEach(function(t){var i={x:(t.x-c)*p/x+r,y:v.canvas.width-20-((t.y-c)*p/x+r)};v.points.push(i)}),console.log(this.points)},Graph.prototype.drawAxis=function(){ctx=this.canvas.getContext("2d");var t=this.canvas.width/10;ctx.save(),ctx.beginPath(),ctx.moveTo(t/2,this.canvas.height-t/2),ctx.lineTo(this.canvas.width,this.canvas.height-t/2),ctx.moveTo(t/2,0),ctx.lineTo(t/2,this.canvas.height-t/2),ctx.strokeStyle="#777777",ctx.stroke(),ctx.restore()},Graph.prototype.draw=function(t){function i(t,i){for(var o=i[0],s=Math.abs(t-o.x),a=0;a<i.length;a++){var e=Math.abs(t-i[a].x);e<s&&(s=e,o=i[a],o.index=a)}return o}var o=this.canvas,s=o.getContext("2d"),a=0;this.realWidth/this.points.length;s.clearRect(0,0,o.width,o.height),s.fillStyle="#FFF",s.fillRect(0,0,o.width,o.height),s.fillStyle="#FFF",s.beginPath(),s.save();s.moveTo(this.points[0].x,this.points[0].y);for(var a=0;a<this.points.length;a++)s.lineTo(this.points[a].x,this.points[a].y);if(s.strokeStyle="#00C853",s.lineWidth=2*this.ratio,s.shadowColor="#999",s.shadowBlur=1,s.shadowOffsetX=2,s.shadowOffsetY=2,s.stroke(),s.restore(),this.position.x){var i=i(this.position.x,this.points);i.x!=this.tooltip.oldx&&(this.tooltip.oldx=i.x,this.tooltip.radius=0),s.save(),s.beginPath(),s.moveTo(i.x,0),s.lineTo(i.x,o.height),s.strokeStyle="#777777",s.stroke(),s.restore(),s.save(),s.beginPath(),s.arc(i.x,i.y,this.tooltip.radius*this.ratio,0,2*Math.PI,!1),this.tooltip.radius<5&&(this.tooltip.radius+=.25),s.fillStyle="#00C853",s.shadowColor="#999",s.shadowBlur=10,s.shadowOffsetX=2,s.shadowOffsetY=2,s.fill(),s.restore(),this.drawTooltip(i),this.drawAxis()}},Graph.prototype.drawTooltip=function(t){var i=this.canvas.getContext("2d");void 0==t.index&&(t.index=0);var o="X:"+this.dataset[t.index].x+" Y:"+this.dataset[t.index].y;i.font="15px Arial";var s=i.measureText(o).width+15,a=20*this.ratio;this.position.x>t.x&&(a=-(20+s)*this.ratio);var e={x:t.x+a,y:t.y-10},h={x:Math.abs(this.tooltip.x-e.x)/15,y:Math.abs(this.tooltip.y-e.y)/15};this.tooltip.x!=e.x&&(e.x>this.tooltip.x?this.tooltip.x+=h.x:this.tooltip.x-=h.x),this.tooltip.y!=e.y&&(e.y>this.tooltip.y?this.tooltip.y+=h.y:this.tooltip.y-=h.y),i.save(),i.beginPath(),i.rect(this.tooltip.x,this.tooltip.y,s*this.ratio,20*this.ratio),i.fillStyle="#cccccc",i.shadowColor="#999",i.shadowBlur=10,i.shadowOffsetX=5,i.shadowOffsetY=5,i.fill(),i.restore(),i.save(),i.beginPath(),i.fillStyle="#000",i.font="15px Arial",i.fillText(o,this.tooltip.x+5,this.tooltip.y+15),i.fill(),i.restore()},Graph.prototype.getMousePos=function(t){t.preventDefault();var i=this.canvas.getBoundingClientRect();return window.event.touches?{x:(window.event.touches[0].pageX-i.left)*this.ratio,y:(window.event.touches[0].pageY-i.top)*this.ratio}:{x:(t.clientX-i.left)*this.ratio,y:(t.clientY-i.top)*this.ratio}},Graph.prototype.makeHighRes=function(){var t=this.canvas.getContext("2d"),i=window.devicePixelRatio||1,o=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,s=i/o;if(i!==o){var a=this.canvas.width,e=this.canvas.height;this.canvas.width=Math.round(a*s),this.canvas.height=Math.round(e*s),this.canvas.style.width=a+"px",this.canvas.style.height=e+"px",t.save(),t.scale(s,s),this.ratio=s,t.restore()}};