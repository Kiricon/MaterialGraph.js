var Graph=function(t,i){this.canvas=this.readElementString(t),this.dataset=i,this.points=[],this.drawPoints=[],this.position={x:0,y:0},this.min=0,this.max=0,this.highlight="",this.point={},this.ratio=1,this.realWidth,this.tooltip={x:this.canvas.width/2,y:this.canvas.height/2,radius:0,oldx:0},this.init(),this.convert();var s=this;setInterval(function(){s.draw()},20);this.listen()};Graph.prototype.init=function(){this.canvas.getContext("2d");this.makeHighRes()},Graph.prototype.listen=function(){var t=this;this.canvas.addEventListener("mousemove",function(i){t.position=t.getMousePos(i)},!1),this.canvas.addEventListener("touchmove",function(i){t.position=t.getMousePos(i)},!1),this.canvas.addEventListener("touchstart",function(i){t.position=t.getMousePos(i)},!1)},Graph.prototype.convert=function(){var t=this.canvas.width/10,i=0,s=0;this.dataset.forEach(function(t){t.x>i&&(i=t.x),t.y>s&&(s=t.y)});var o=i,a=s;this.dataset.forEach(function(t){t.x<o&&(o=t.x),t.y<a&&(a=t.y)});var h=Math.abs(i-o),e=Math.abs(s-a),n=this.canvas.width-t,r=t;if(this.min=r,this.max=n,h>e)var l=i,c=o;else var l=s,c=a;var x=l-c,p=n-r,d=this;this.dataset.forEach(function(t,i){var s={x:Math.round((t.x-c)*p/x+r),y:Math.round(d.canvas.width-20-((t.y-c)*p/x+r))};if(d.drawPoints.push(s),d.drawPoints[i-1]){var o={x:d.drawPoints[i-1].x,y:d.drawPoints[i-1].y};d.points.push(o)}else console.log("this happens"),d.points.push({x:0,y:0})}),this.points[0]={x:this.drawPoints[0].x,y:this.drawPoints[0].y},console.log(this.points),console.log(this.drawPoints)},Graph.prototype.drawAxis=function(){ctx=this.canvas.getContext("2d");var t=this.canvas.width/10;ctx.save(),ctx.beginPath(),ctx.moveTo(t/2,this.canvas.height-t/2),ctx.lineTo(this.canvas.width,this.canvas.height-t/2),ctx.moveTo(t/2,0),ctx.lineTo(t/2,this.canvas.height-t/2),ctx.strokeStyle="#777777",ctx.stroke(),ctx.restore(),ctx.save(),ctx.beginPath(),ctx.fillStyle="#000",ctx.font="12px Arial",ctx.fillText("X",t/4,this.canvas.height-t/2+3),ctx.fillText("Y",t/2-5,this.canvas.height-t/4+5),ctx.fill(),ctx.restore()},Graph.prototype.draw=function(t){function i(t,i){for(var s=i[0],o=Math.abs(t-s.x),a=0;a<i.length;a++){var h=Math.abs(t-i[a].x);h<o&&(o=h,s=i[a],s.index=a)}return s}var s=this.canvas;this.canvas.style.cursor="crosshair";var o=s.getContext("2d"),a=0;this.realWidth/this.points.length;o.clearRect(0,0,s.width,s.height),o.fillStyle="#FFF",o.fillRect(0,0,s.width,s.height),o.fillStyle="#FFF";var h=this.canvas.width/10;o.beginPath(),o.save();o.moveTo(this.points[0].x,this.points[0].y);for(var a=0;a<this.points.length;){if(this.points[a].x==this.drawPoints[a].x&&this.points[a].y==this.drawPoints[a].y)o.lineTo(this.points[a].x,this.points[a].y),a==this.points.length-1&&0==this.position.x&&0==this.position.y&&(this.position={x:1,y:1});else{var e=Math.abs(this.drawPoints[a].x-this.points[a].x),n=Math.abs(this.drawPoints[a].y-this.points[a].y),r=this.canvas.width/100,l=this.canvas.height/100;e>r&&(e/=6),n>l&&(n/=6),this.points[a].x<this.drawPoints[a].x?this.points[a].x+=e:this.points[a].x>this.drawPoints[a].x&&(this.points[a].x-=e),this.points[a].y<this.drawPoints[a].y?this.points[a].y+=n:this.points[a].y>this.drawPoints[a].y&&(this.points[a].y-=n),o.lineTo(this.points[a].x,this.points[a].y),a=this.points.length+1}a++}if(o.strokeStyle="#00C853",o.lineWidth=2*this.ratio,o.shadowColor="#999",o.shadowBlur=1,o.shadowOffsetX=2,o.shadowOffsetY=2,o.stroke(),o.restore(),this.position.x){var i=i(this.position.x,this.points);i.x!=this.tooltip.oldx&&(this.tooltip.oldx=i.x,this.tooltip.radius=0),o.save(),o.beginPath(),o.moveTo(i.x,0),o.lineTo(i.x,s.height-h/2),o.strokeStyle="#777777",o.stroke(),o.restore(),o.save(),o.beginPath(),o.arc(i.x,i.y,this.tooltip.radius*this.ratio,0,2*Math.PI,!1),this.tooltip.radius<5&&(this.tooltip.radius+=.25),o.fillStyle="#00C853",o.shadowColor="#999",o.shadowBlur=10,o.shadowOffsetX=2,o.shadowOffsetY=2,o.fill(),o.lineWidth=2,o.strokeStyle="#333",o.stroke(),o.restore(),this.drawAxis(),this.drawTooltip(i)}},Graph.prototype.drawTooltip=function(t){var i=this.canvas.getContext("2d");void 0==t.index&&(t.index=0);var s="X:"+this.dataset[t.index].x+" Y:"+this.dataset[t.index].y;i.font="15px Arial";var o=i.measureText(s).width+15,a=20*this.ratio;this.position.x>t.x&&(a=-(20+o)*this.ratio);var h={x:t.x+a,y:t.y-10},e={x:Math.abs(this.tooltip.x-h.x)/15,y:Math.abs(this.tooltip.y-h.y)/15};this.tooltip.x!=h.x&&(h.x>this.tooltip.x?this.tooltip.x+=e.x:this.tooltip.x-=e.x),this.tooltip.y!=h.y&&(h.y>this.tooltip.y?this.tooltip.y+=e.y:this.tooltip.y-=e.y),i.save(),i.beginPath(),i.rect(this.tooltip.x,this.tooltip.y,o*this.ratio,20*this.ratio),i.fillStyle="#cccccc",i.shadowColor="#999",i.shadowBlur=10,i.shadowOffsetX=5,i.shadowOffsetY=5,i.fill(),i.restore(),i.save(),i.beginPath(),i.fillStyle="#000",i.font="15px Arial",i.fillText(s,this.tooltip.x+5,this.tooltip.y+15),i.fill(),i.restore()},Graph.prototype.getMousePos=function(t){t.preventDefault();var i=this.canvas.getBoundingClientRect();return window.event.touches?{x:(window.event.touches[0].pageX-i.left)*this.ratio,y:(window.event.touches[0].pageY-i.top)*this.ratio}:{x:(t.clientX-i.left)*this.ratio,y:(t.clientY-i.top)*this.ratio}},Graph.prototype.makeHighRes=function(){var t=this.canvas.getContext("2d"),i=window.devicePixelRatio||1,s=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,o=i/s;if(i!==s){var a=this.canvas.width,h=this.canvas.height;this.canvas.width=Math.round(a*o),this.canvas.height=Math.round(h*o),this.canvas.style.width=a+"px",this.canvas.style.height=h+"px",t.save(),t.scale(o,o),this.ratio=o,t.restore()}},Graph.prototype.readElementString=function(t){var i=t,s=i.charAt(0),o=i.substr(1);if("#"==s)var a=document.getElementById(o);else if("."==s)var a=document.getElementsByClassName(o)[0];else var a=document.getElementsByTagName(i)[0];return a};