var Graph=function(t,i){this.canvas=t,this.dataset=i,this.points=[],this.position={x:0,y:0},this.min=0,this.max=0,this.highlight="",this.point={},this.ratio=1,this.realWidth,this.init(),this.convert(),this.listen(),this.draw()};Graph.prototype.init=function(){this.canvas.getContext("2d");this.makeHighRes()},Graph.prototype.listen=function(){var t=this;this.canvas.addEventListener("mousemove",function(i){t.position=t.getMousePos(i),t.draw()},!1),this.canvas.addEventListener("touchmove",function(i){t.position=t.getMousePos(i),t.draw()},!1),this.canvas.addEventListener("touchstart",function(i){t.position=t.getMousePos(i),t.draw()},!1)},Graph.prototype.convert=function(){var t=0,i=0;this.dataset.forEach(function(s){s.x>t&&(t=s.x),s.y>i&&(i=s.y)});var s=t,o=i;this.dataset.forEach(function(t){t.x<s&&(s=t.x),t.y<o&&(o=t.y)});var e=Math.abs(t-s),a=Math.abs(i-o),h=this.canvas.width-20,n=20;if(this.min=n,this.max=h,e>a)var r=t,c=s;else var r=i,c=o;console.log(h+" "+n);var l=r-c,v=h-n,d=this;this.dataset.forEach(function(t){var i={x:(t.x-c)*v/l+n,y:d.canvas.width-20-((t.y-c)*v/l+n)};d.points.push(i)}),console.log(this.points)},Graph.prototype.draw=function(t){function i(t,i){for(var s=i[0],o=Math.abs(t-s.x),e=0;e<i.length;e++){var a=Math.abs(t-i[e].x);a<o&&(o=a,s=i[e])}return s}var s=this.canvas,o=s.getContext("2d"),e=0;this.realWidth/this.points.length;o.clearRect(0,0,s.width,s.height),o.fillStyle="#FFF",o.fillRect(0,0,s.width,s.height),o.fillStyle="#FFF",o.beginPath(),o.save();o.moveTo(this.points[0].x,this.points[0].y);for(var e=0;e<this.points.length;e++)o.lineTo(this.points[e].x,this.points[e].y);if(o.strokeStyle="#00C853",o.lineWidth=2*this.ratio,o.shadowColor="#999",o.shadowBlur=1,o.shadowOffsetX=2,o.shadowOffsetY=2,o.stroke(),o.restore(),this.position.x){var i=i(this.position.x,this.points);o.save(),o.beginPath(),o.moveTo(i.x,0),o.lineTo(i.x,s.height),o.strokeStyle="#777777",o.stroke(),o.restore(),o.save(),o.beginPath(),o.arc(i.x,i.y,5,0,2*Math.PI,!1),o.fillStyle="#00C853",o.shadowColor="#999",o.shadowBlur=10,o.shadowOffsetX=2,o.shadowOffsetY=2,o.fill(),o.restore();var a=20;this.position.x<i.x&&(a=-70),o.save(),o.beginPath(),o.rect(i.x+a,i.y-10,50,20),o.fillStyle="#cccccc",o.shadowColor="#999",o.shadowBlur=10,o.shadowOffsetX=10,o.shadowOffsetY=10,o.fill(),o.restore()}},Graph.prototype.getMousePos=function(t){t.preventDefault();var i=this.canvas.getBoundingClientRect();return window.event.touches?{x:(window.event.touches[0].pageX-i.left)*this.ratio,y:(window.event.touches[0].pageY-i.top)*this.ratio}:{x:(t.clientX-i.left)*this.ratio,y:(t.clientY-i.top)*this.ratio}},Graph.prototype.makeHighRes=function(){var t=this.canvas.getContext("2d"),i=window.devicePixelRatio||1,s=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,o=i/s;if(i!==s){var e=this.canvas.width,a=this.canvas.height;this.canvas.width=Math.round(e*o),this.canvas.height=Math.round(a*o),this.canvas.style.width=e+"px",this.canvas.style.height=a+"px",t.save(),t.scale(o,o),this.ratio=o,t.restore()}};